<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Flask-Login &mdash; Flask-Login 0.3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Flask-Login 0.3.0 documentation" href="#" /> 
  </head>
  <body>
  
  
  <div class=indexwrapper>
  


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="flask-login">
<h1>Flask-Login<a class="headerlink" href="#flask-login" title="Permalink to this headline">¶</a></h1>
<p>Flask-Login 为 Flask 提供了用户会话管理。它处理了日常的登入，登出并且长时间记住用户的会话。</p>
<p>它会:</p>
<ul class="simple">
<li>在会话中存储当前活跃的用户 ID，让你能够自由地登入和登出。</li>
<li>让你限制登入(或者登出)用户可以访问的视图。</li>
<li>处理让人棘手的 “记住我” 功能。</li>
<li>帮助你保护用户会话免遭 cookie 被盗的牵连。</li>
<li>可以与以后可能使用的 Flask-Principal 或其它认证扩展集成。</li>
</ul>
<p>但是，它不会:</p>
<ul class="simple">
<li>限制你使用特定的数据库或其它存储方法。如何加载用户完全由你决定。</li>
<li>限制你使用用户名和密码，OpenIDs，或者其它的认证方法。</li>
<li>处理超越 “登入或者登出” 之外的权限。</li>
<li>处理用户注册或者账号恢复。</li>
</ul>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id16">配置你的应用</a></li>
<li><a class="reference internal" href="#id2" id="id17">它是如何工作</a></li>
<li><a class="reference internal" href="#id3" id="id18">你的用户类</a></li>
<li><a class="reference internal" href="#id4" id="id19">定制登入过程</a></li>
<li><a class="reference internal" href="#authorization-header" id="id20">使用授权头(Authorization header)登录</a></li>
<li><a class="reference internal" href="#request-loader" id="id21">使用 Request Loader 定制登录</a></li>
<li><a class="reference internal" href="#id5" id="id22">匿名用户</a></li>
<li><a class="reference internal" href="#id6" id="id23">记住我</a><ul>
<li><a class="reference internal" href="#id7" id="id24">可选令牌</a></li>
<li><a class="reference internal" href="#fresh-logins" id="id25">”新鲜的“登录(Fresh Logins)</a></li>
<li><a class="reference internal" href="#cookie" id="id26">Cookie 设置</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8" id="id27">会话保护</a></li>
<li><a class="reference internal" href="#id9" id="id28">本地化</a></li>
<li><a class="reference internal" href="#api" id="id29">API 文档</a><ul>
<li><a class="reference internal" href="#id10" id="id30">配置登录</a></li>
<li><a class="reference internal" href="#id11" id="id31">登录机制</a></li>
<li><a class="reference internal" href="#id12" id="id32">保护视图</a></li>
<li><a class="reference internal" href="#id13" id="id33">用户对象助手</a></li>
<li><a class="reference internal" href="#id14" id="id34">工具</a></li>
<li><a class="reference internal" href="#id15" id="id35">信号</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2>配置你的应用<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>对一个使用 Flask-Login 的应用最重要的一部分就是 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 类。你应该在你的代码的某处为应用创建一个，像这样:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span> <span class="o">=</span> <span class="n">LoginManager</span><span class="p">()</span>
</pre></div>
</div>
<p>登录管理(login manager)包含了让你的应用和 Flask-Login 协同工作的代码，比如怎样从一个 ID 加载用户，当用户需要登录的时候跳转到哪里等等。</p>
<p>一旦实际的应用对象创建后，你能够这样配置它来实现登录:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>它是如何工作<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>你必须提供一个 <a class="reference internal" href="#flask.ext.login.LoginManager.user_loader" title="flask.ext.login.LoginManager.user_loader"><tt class="xref py py-obj docutils literal"><span class="pre">user_loader</span></tt></a> 回调。这个回调用于从会话中存储的用户 ID 重新加载用户对象。它应该接受一个用户的 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">unicode</span></tt></a> ID 作为参数，并且返回相应的用户对象。比如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_manager.user_loader</span>
<span class="k">def</span> <span class="nf">load_user</span><span class="p">(</span><span class="n">userid</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 ID 无效的话，它应该返回 <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a> (<strong>而不是抛出异常</strong>)。(在这种情况下，ID 会被手动从会话中移除且处理会继续)</p>
<p>一旦用户通过验证，你可以使用 <a class="reference internal" href="#flask.ext.login.login_user" title="flask.ext.login.login_user"><tt class="xref py py-obj docutils literal"><span class="pre">login_user</span></tt></a> 函数让用户登录。例如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/login&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="c"># login and validate the user...</span>
        <span class="n">login_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">&quot;Logged in successfully.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;next&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&quot;login.html&quot;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
</pre></div>
</div>
<p>就这么简单。你可用使用 <a class="reference internal" href="#flask.ext.login.current_user" title="flask.ext.login.current_user"><tt class="xref py py-obj docutils literal"><span class="pre">current_user</span></tt></a> 代理来访问登录的用户，在每一个模板中都可以使用 <a class="reference internal" href="#flask.ext.login.current_user" title="flask.ext.login.current_user"><tt class="xref py py-obj docutils literal"><span class="pre">current_user</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>{% if current_user.is_authenticated() %}
  Hi {{ current_user.name }}!
{% endif %}
</pre></div>
</div>
<p>需要用户登入 的视图可以用 <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a> 装饰器来装饰:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/settings&quot;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">settings</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>当用户要登出时:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/logout&quot;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">logout_user</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">somewhere</span><span class="p">)</span>
</pre></div>
</div>
<p>他们会被登出，且他们会话产生的任何 cookie 都会被清理干净。</p>
</div>
<div class="section" id="id3">
<h2>你的用户类<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>你用来表示用户的类需要实现这些属性和方法:</p>
<dl class="docutils">
<dt><tt class="xref py py-obj docutils literal"><span class="pre">is_authenticated</span></tt></dt>
<dd>当用户通过验证时，也即提供有效证明时返回 <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a> 。（只有通过验证的用户会满足 <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a> 的条件。）</dd>
<dt><tt class="xref py py-obj docutils literal"><span class="pre">is_active</span></tt></dt>
<dd>如果这是一个活动用户且通过验证，账户也已激活，未被停用，也不符合任何你 的应用拒绝一个账号的条件，返回 <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a> 。不活动的账号可能不会登入（当然， 是在没被强制的情况下）。</dd>
<dt><tt class="xref py py-obj docutils literal"><span class="pre">is_anonymous</span></tt></dt>
<dd>如果是一个匿名用户，返回 <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a> 。（真实用户应返回 <a class="reference external" href="http://docs.python.org/library/constants.html#False" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">False</span></tt></a> 。）</dd>
<dt><tt class="xref py py-obj docutils literal"><span class="pre">get_id()</span></tt></dt>
<dd>返回一个能唯一识别用户的，并能用于从 <a class="reference internal" href="#flask.ext.login.LoginManager.user_loader" title="flask.ext.login.LoginManager.user_loader"><tt class="xref py py-obj docutils literal"><span class="pre">user_loader</span></tt></a> 回调中加载用户的 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">unicode</span></tt></a> 。注意着 <strong>必须</strong> 是一个 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">unicode</span></tt></a> —— 如果 ID 原本是 一个 <a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">int</span></tt></a> 或其它类型，你需要把它转换为 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">unicode</span></tt></a> 。</dd>
</dl>
<p>要简便地实现用户类，你可以从 <a class="reference internal" href="#flask.ext.login.UserMixin" title="flask.ext.login.UserMixin"><tt class="xref py py-obj docutils literal"><span class="pre">UserMixin</span></tt></a> 继承，它提供了对所有这些方法的默认 实现。（虽然这不是必须的。）</p>
</div>
<div class="section" id="id4">
<h2>定制登入过程<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>默认情况下，当未登录的用户尝试访问一个 <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a> 装饰的视图，Flask-Login 会闪现一条消息并且重定向到登录视图。(如果未设置登录视图，它将会以 401 错误退出。)</p>
<p>登录视图的名称可以设置成 <a class="reference internal" href="#flask.ext.login.LoginManager.login_view" title="flask.ext.login.LoginManager.login_view"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager.login_view</span></tt></a>。例如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">login_view</span> <span class="o">=</span> <span class="s">&quot;users.login&quot;</span>
</pre></div>
</div>
<p>默认的闪现消息是 <tt class="docutils literal"><span class="pre">Please</span> <span class="pre">log</span> <span class="pre">in</span> <span class="pre">to</span> <span class="pre">access</span> <span class="pre">this</span> <span class="pre">page.</span></tt>。要自定义该信息，请设置 <a class="reference internal" href="#flask.ext.login.LoginManager.login_message" title="flask.ext.login.LoginManager.login_message"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager.login_message</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">login_message</span> <span class="o">=</span> <span class="s">u&quot;Bonvolu ensaluti por uzi tio pa臐o.&quot;</span>
</pre></div>
</div>
<p>要自定义消息分类的话，请设置 <tt class="xref py py-obj docutils literal"><span class="pre">LoginManager.login_message_category</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">login_message_category</span> <span class="o">=</span> <span class="s">&quot;info&quot;</span>
</pre></div>
</div>
<p>当重定向到登入视图，它的请求字符串中会有一个 <tt class="docutils literal"><span class="pre">next</span></tt> 变量，其值为用户之前访问的页面。</p>
<p>如果你想要进一步自定义登入过程，请使用 <a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized_handler" title="flask.ext.login.LoginManager.unauthorized_handler"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager.unauthorized_handler</span></tt></a> 装饰函数:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_manager.unauthorized_handler</span>
<span class="k">def</span> <span class="nf">unauthorized</span><span class="p">():</span>
    <span class="c"># do stuff</span>
    <span class="k">return</span> <span class="n">a_response</span>
</pre></div>
</div>
</div>
<div class="section" id="authorization-header">
<h2>使用授权头(Authorization header)登录<a class="headerlink" href="#authorization-header" title="Permalink to this headline">¶</a></h2>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">该方法将会被弃用，使用下一节的 <tt class="xref py py-obj docutils literal"><span class="pre">request_loader</span></tt> 来代替。</p>
</div>
<p>有些时候你要支持使用 <tt class="xref py py-obj docutils literal"><span class="pre">Authorization</span></tt> 头的基本认证登录，比如 API 请求。为了支持通过头登录你需要提供一个 <a class="reference internal" href="#flask.ext.login.LoginManager.header_loader" title="flask.ext.login.LoginManager.header_loader"><tt class="xref py py-obj docutils literal"><span class="pre">header_loader</span></tt></a> 回调。这个回调和 <a class="reference internal" href="#flask.ext.login.LoginManager.user_loader" title="flask.ext.login.LoginManager.user_loader"><tt class="xref py py-obj docutils literal"><span class="pre">user_loader</span></tt></a> 回调作用一样，只是它接受一个 HTTP 头(Authorization)而不是用户 id。例如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_manager.header_loader</span>
<span class="k">def</span> <span class="nf">load_user_from_header</span><span class="p">(</span><span class="n">header_val</span><span class="p">):</span>
    <span class="n">header_val</span> <span class="o">=</span> <span class="n">header_val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;Basic &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">header_val</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">header_val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">header_val</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>
</div>
<p>默认情况下 <tt class="xref py py-obj docutils literal"><span class="pre">Authorization</span></tt> 的值传给 <a class="reference internal" href="#flask.ext.login.LoginManager.header_loader" title="flask.ext.login.LoginManager.header_loader"><tt class="xref py py-obj docutils literal"><span class="pre">header_loader</span></tt></a> 回调。你可以使用 <tt class="xref py py-obj docutils literal"><span class="pre">AUTH_HEADER_NAME</span></tt> 配置来修改使用的 HTTP 头(可以不使用 <tt class="xref py py-obj docutils literal"><span class="pre">Authorization</span></tt>，使用 <tt class="xref py py-obj docutils literal"><span class="pre">Token</span></tt>)。</p>
</div>
<div class="section" id="request-loader">
<h2>使用 Request Loader 定制登录<a class="headerlink" href="#request-loader" title="Permalink to this headline">¶</a></h2>
<p>有时你想要不使用 cookies 情况下登录用户，比如使用 HTTP 头或者一个作为查询参数的 api 密钥。这种情况下，你应该使用 <tt class="xref py py-obj docutils literal"><span class="pre">request_loader</span></tt> 回调。这个回调和 <a class="reference internal" href="#flask.ext.login.LoginManager.user_loader" title="flask.ext.login.LoginManager.user_loader"><tt class="xref py py-obj docutils literal"><span class="pre">user_loader</span></tt></a> 回调作用一样，但是 <a class="reference internal" href="#flask.ext.login.LoginManager.user_loader" title="flask.ext.login.LoginManager.user_loader"><tt class="xref py py-obj docutils literal"><span class="pre">user_loader</span></tt></a> 回调只接受 Flask 请求而不是一个 user_id。</p>
<p>例如，为了同时支持一个 url 参数和使用 <tt class="xref py py-obj docutils literal"><span class="pre">Authorization</span></tt> 头的基本用户认证的登录:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_manager.request_loader</span>
<span class="k">def</span> <span class="nf">load_user_from_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="c"># first, try to login using the api_key url arg</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;api_key&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">user</span>

    <span class="c"># next, try to login using Basic Auth</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Authorization&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">api_key</span><span class="p">:</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;Basic &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">user</span>

    <span class="c"># finally, return None if both methods did not login the user</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>匿名用户<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>默认情况下，当一个用户没有真正地登录，<a class="reference internal" href="#flask.ext.login.current_user" title="flask.ext.login.current_user"><tt class="xref py py-obj docutils literal"><span class="pre">current_user</span></tt></a> 被设置成一个 <tt class="xref py py-obj docutils literal"><span class="pre">AnonymousUserMixin</span></tt> 对象。它由如下的属性和方法:</p>
<ul class="simple">
<li><tt class="xref py py-obj docutils literal"><span class="pre">is_active</span></tt> 和 <tt class="xref py py-obj docutils literal"><span class="pre">is_authenticated</span></tt> 的值为 <a class="reference external" href="http://docs.python.org/library/constants.html#False" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">False</span></tt></a></li>
<li><tt class="xref py py-obj docutils literal"><span class="pre">is_anonymous</span></tt> 的值为 <a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a></li>
<li><tt class="xref py py-obj docutils literal"><span class="pre">get_id()</span></tt> 返回 <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a></li>
</ul>
<p>如果需要为匿名用户定制一些需求(比如，需要一个权限域)，你可以向 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 提供一个创建匿名用户的回调（类或工厂函数）:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">anonymous_user</span> <span class="o">=</span> <span class="n">MyAnonymousUser</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2>记住我<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>&#8220;记住我&#8221;的功能很难实现。但是，Flask-Login 几乎透明地实现它 - 只要把 <tt class="docutils literal"><span class="pre">remember=True</span></tt> 传递给 <a class="reference internal" href="#flask.ext.login.login_user" title="flask.ext.login.login_user"><tt class="xref py py-obj docutils literal"><span class="pre">login_user</span></tt></a>。一个 cookie 将会存储在用户计算机中，如果用户会话中没有用户 ID 的话，Flask-Login 会自动地从 cookie 中恢复用户 ID。cookie 是防纂改的，因此如果用户纂改过它(比如，使用其它的一些东西来代替用户的 ID)，它就会被拒绝，就像不存在。</p>
<p>该层功能是被自动实现的。但你能（且应该，如果你的应用处理任何敏感的数据）提供 额外基础工作来增强你记住的 cookie 的安全性。</p>
<div class="section" id="id7">
<h3>可选令牌<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>使用用户 ID 作为记住的令牌值不一定是安全的。更安全的方法是使用用户名和密码联合的 hash 值，或类似的东西。要添加一个额外的令牌，向你的用户对象添加一个方法：</p>
<dl class="docutils">
<dt><tt class="xref py py-obj docutils literal"><span class="pre">get_auth_token()</span></tt></dt>
<dd>返回用户的认证令牌（返回为 <a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">unicode</span></tt></a> ）。这个认证令牌应能唯一识别用户，且 不易通过用户的公开信息，如 UID 和名称来猜测出——同样也不应暴露这些信息。</dd>
</dl>
<p>相应地，你应该在 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 上设置一个 <a class="reference internal" href="#flask.ext.login.LoginManager.token_loader" title="flask.ext.login.LoginManager.token_loader"><tt class="xref py py-obj docutils literal"><span class="pre">token_loader</span></tt></a> 函数， 它接受令牌（存储在 cookie 中）作为参数并返回合适的 User 对象。</p>
<p><a class="reference internal" href="#flask.ext.login.make_secure_token" title="flask.ext.login.make_secure_token"><tt class="xref py py-obj docutils literal"><span class="pre">make_secure_token</span></tt></a> 函数用于便利创建认证令牌。它会连接所有的参数，然后用应用的密钥来 HMAC 它确保最大的密码学安全。（如果你永久地在数据库中存储用户令牌，那么 你会希望向令牌中添加随机数据来阻碍猜测。）</p>
<p>如果你的应用使用密码来验证用户，在认证令牌中包含密码（或你应使用的加盐值的密码 hash ）能确保若用户更改密码，他们的旧认证令牌会失效。</p>
</div>
<div class="section" id="fresh-logins">
<h3>”新鲜的“登录(Fresh Logins)<a class="headerlink" href="#fresh-logins" title="Permalink to this headline">¶</a></h3>
<p>当用户登入，他们的会话被标记成“新鲜的”，就是说在这个会话只中用户实际上登录过。当会话销毁用户使用“记住我”的 cookie 重新登入，会话被标记成“非新鲜的”。<a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a> 并不在意它们之间的不同，这适用于大部分页面。然而，更改某人 的个人信息这样的敏感操作应需要一个“新鲜的”的登入。（像修改密码这样的操作总是需要 密码，无论是否重登入。）</p>
<p><a class="reference internal" href="#flask.ext.login.fresh_login_required" title="flask.ext.login.fresh_login_required"><tt class="xref py py-obj docutils literal"><span class="pre">fresh_login_required</span></tt></a>，除了验证用户登录，也将确保他们的登录是“新鲜的”。如果不是“新鲜的”，它会把用户送到可以重输入验证条件的页面。你可以定制 <a class="reference internal" href="#flask.ext.login.fresh_login_required" title="flask.ext.login.fresh_login_required"><tt class="xref py py-obj docutils literal"><span class="pre">fresh_login_required</span></tt></a> 就像定制 <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a> 那样，通过设置 <a class="reference internal" href="#flask.ext.login.LoginManager.refresh_view" title="flask.ext.login.LoginManager.refresh_view"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager.refresh_view</span></tt></a>，<a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh_message" title="flask.ext.login.LoginManager.needs_refresh_message"><tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh_message</span></tt></a>，和
<tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh_message_category</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">refresh_view</span> <span class="o">=</span> <span class="s">&quot;accounts.reauthenticate&quot;</span>
<span class="n">login_manager</span><span class="o">.</span><span class="n">needs_refresh_message</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">u&quot;To protect your account, please reauthenticate to access this page.&quot;</span>
<span class="p">)</span>
<span class="n">login_manager</span><span class="o">.</span><span class="n">needs_refresh_message_category</span> <span class="o">=</span> <span class="s">&quot;info&quot;</span>
</pre></div>
</div>
<p>或者提供自己的回调来处理“非新鲜的”刷新:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@login_manager.needs_refresh_handler</span>
<span class="k">def</span> <span class="nf">refresh</span><span class="p">():</span>
    <span class="c"># do stuff</span>
    <span class="k">return</span> <span class="n">a_response</span>
</pre></div>
</div>
<p>调用 <a class="reference internal" href="#flask.ext.login.confirm_login" title="flask.ext.login.confirm_login"><tt class="xref py py-obj docutils literal"><span class="pre">confirm_login</span></tt></a> 函数可以重新标记会话为”新鲜“。</p>
</div>
<div class="section" id="cookie">
<h3>Cookie 设置<a class="headerlink" href="#cookie" title="Permalink to this headline">¶</a></h3>
<p>cookie 的细节可以在应用设置中定义。</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">REMEMBER_COOKIE_NAME</span></tt></td>
<td>存储“记住我”信息的 cookie 名。
<strong>默认值</strong>： remember_token</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">REMEMBER_COOKIE_DURATION</span></tt></td>
<td>cookie 过期时间，为一个 <a class="reference external" href="http://docs.python.org/library/datetime.html#datetime.timedelta" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">datetime.timedelta</span></tt></a> 对象。
<strong>默认值：</strong> 365 天 (1 非闰阳历年)</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-obj docutils literal"><span class="pre">REMEMBER_COOKIE_DOMAIN</span></tt></td>
<td>如果“记住我” cookie 应跨域，在此处设置域名值
（即 .example.com 会允许 example 下所有子域 名）。
<strong>默认值：</strong> None</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-obj docutils literal"><span class="pre">REMEMBER_COOKIE_PATH</span></tt></td>
<td>限制”记住我“ cookie 存储到某一路径下。
<strong>默认值：</strong> <tt class="docutils literal"><span class="pre">/</span></tt></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id8">
<h2>会话保护<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>当上述特性保护“记住我”令牌免遭 cookie 窃取时，会话 cookie 仍然是脆弱的。 Flask-Login 包含了会话保护来帮助阻止用户会话被盗用。</p>
<p>你可以在 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 上和应用配置中配置会话保护。如果它被启用，它可以在 <tt class="xref py py-obj docutils literal"><span class="pre">basic</span></tt> 或 <tt class="xref py py-obj docutils literal"><span class="pre">strong</span></tt> 两种模式中运行。要在 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 上设置它，设置 <tt class="xref py py-obj docutils literal"><span class="pre">session_protection</span></tt> 属性为 <tt class="docutils literal"><span class="pre">&quot;basic&quot;</span></tt> 或 <tt class="docutils literal"><span class="pre">&quot;strong&quot;</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">session_protection</span> <span class="o">=</span> <span class="s">&quot;strong&quot;</span>
</pre></div>
</div>
<p>或者，禁用它:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">login_manager</span><span class="o">.</span><span class="n">session_protection</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>默认，它被激活为 <tt class="docutils literal"><span class="pre">&quot;basic&quot;</span></tt> 模式。它可以在应用配置中设定 <tt class="xref py py-obj docutils literal"><span class="pre">SESSION_PROTECTION</span></tt> 为 <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a> 、 <tt class="docutils literal"><span class="pre">&quot;basic&quot;</span></tt> 或 <tt class="docutils literal"><span class="pre">&quot;strong&quot;</span></tt> 来禁用。</p>
<p>当启用了会话保护，每个请求，它生成一个用户电脑的标识（基本上是 IP 地址和 User Agent 的 MD5 hash 值）。如果会话不包含相关的标识，则存储生成的。如果存在标识，则匹配生成的，之后请求可用。</p>
<p>在 <tt class="xref py py-obj docutils literal"><span class="pre">basic</span></tt> 模式下或会话是永久的，如果该标识未匹配，会话会简单地被标记为非活 跃的，且任何需要活跃登入的东西会强制用户重新验证。（当然，你必须已经使用了活跃登入机制才能奏效。）</p>
<p>在 <tt class="xref py py-obj docutils literal"><span class="pre">strong</span></tt> 模式下的非永久会话，如果该标识未匹配，整个会话（记住的令牌如果存在，则同样）被删除。</p>
</div>
<div class="section" id="id9">
<h2>本地化<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>默认情况下，当用户需要登录，<a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 使用 <tt class="docutils literal"><span class="pre">flash</span></tt> 来显示信息。这些信息都是英文的。如果你需要本地化，设置 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 的 <tt class="xref py py-obj docutils literal"><span class="pre">localize_callback</span></tt> 属性为一个函数，该函数在消息被发送到 <tt class="docutils literal"><span class="pre">flash</span></tt> 的时候被调用，比如，<tt class="docutils literal"><span class="pre">gettext</span></tt>。</p>
</div>
<div class="section" id="api">
<h2>API 文档<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>这部分文档是从 Flask-Login 源码中自动生成的。</p>
<div class="section" id="id10">
<h3>配置登录<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="flask.ext.login.LoginManager">
<em class="property">class </em><tt class="descclassname">flask.ext.login.</tt><tt class="descname">LoginManager</tt><big>(</big><em>app=None</em>, <em>add_context_processor=True</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager" title="Permalink to this definition">¶</a></dt>
<dd><p>This object is used to hold the settings used for logging in. Instances of
<a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-class docutils literal"><span class="pre">LoginManager</span></tt></a> are <em>not</em> bound to specific apps, so you can create
one in the main body of your code and then bind it to your
app in a factory function.</p>
<dl class="method">
<dt id="flask.ext.login.LoginManager.setup_app">
<tt class="descname">setup_app</tt><big>(</big><em>app</em>, <em>add_context_processor=True</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.setup_app"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.setup_app" title="Permalink to this definition">¶</a></dt>
<dd><p>This method has been deprecated. Please use
<tt class="xref py py-meth docutils literal"><span class="pre">LoginManager.init_app()</span></tt> instead.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.unauthorized">
<tt class="descname">unauthorized</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.unauthorized"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.unauthorized" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called when the user is required to log in. If you register a
callback with <a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized_handler" title="flask.ext.login.LoginManager.unauthorized_handler"><tt class="xref py py-meth docutils literal"><span class="pre">LoginManager.unauthorized_handler()</span></tt></a>, then it will
be called. Otherwise, it will take the following actions:</p>
<blockquote>
<div><ul class="simple">
<li>Flash <a class="reference internal" href="#flask.ext.login.LoginManager.login_message" title="flask.ext.login.LoginManager.login_message"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.login_message</span></tt></a> to the user.</li>
<li>Redirect the user to <a class="reference internal" href="#flask.ext.login.LoginManager.login_view" title="flask.ext.login.LoginManager.login_view"><tt class="xref py py-obj docutils literal"><span class="pre">login_view</span></tt></a>. (The page they were attempting
to access will be passed in the <tt class="docutils literal"><span class="pre">next</span></tt> query string variable,
so you can redirect there if present instead of the homepage.)</li>
</ul>
</div></blockquote>
<p>If <a class="reference internal" href="#flask.ext.login.LoginManager.login_view" title="flask.ext.login.LoginManager.login_view"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.login_view</span></tt></a> is not defined, then it will simply
raise a HTTP 401 (Unauthorized) error instead.</p>
<p>This should be returned from a view or before/after_request function,
otherwise the redirect will have no effect.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.needs_refresh">
<tt class="descname">needs_refresh</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.needs_refresh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.needs_refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>This is called when the user is logged in, but they need to be
reauthenticated because their session is stale. If you register a
callback with <a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh_handler" title="flask.ext.login.LoginManager.needs_refresh_handler"><tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh_handler</span></tt></a>, then it will be called.
Otherwise, it will take the following actions:</p>
<blockquote>
<div><ul class="simple">
<li>Flash <a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh_message" title="flask.ext.login.LoginManager.needs_refresh_message"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.needs_refresh_message</span></tt></a> to the user.</li>
<li>Redirect the user to <a class="reference internal" href="#flask.ext.login.LoginManager.refresh_view" title="flask.ext.login.LoginManager.refresh_view"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.refresh_view</span></tt></a>. (The page
they were attempting to access will be passed in the <tt class="docutils literal"><span class="pre">next</span></tt>
query string variable, so you can redirect there if present
instead of the homepage.)</li>
</ul>
</div></blockquote>
<p>If <a class="reference internal" href="#flask.ext.login.LoginManager.refresh_view" title="flask.ext.login.LoginManager.refresh_view"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.refresh_view</span></tt></a> is not defined, then it will
simply raise a HTTP 403 (Forbidden) error instead.</p>
<p>This should be returned from a view or before/after_request function,
otherwise the redirect will have no effect.</p>
</dd></dl>

<p class="rubric">General Configuration</p>
<dl class="method">
<dt id="flask.ext.login.LoginManager.user_loader">
<tt class="descname">user_loader</tt><big>(</big><em>callback</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.user_loader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.user_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>This sets the callback for reloading a user from the session. The
function you set should take a user ID (a <tt class="docutils literal"><span class="pre">unicode</span></tt>) and return a
user object, or <tt class="docutils literal"><span class="pre">None</span></tt> if the user does not exist.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><em>unicode</em></a>) &#8211; The callback for retrieving a user object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.header_loader">
<tt class="descname">header_loader</tt><big>(</big><em>callback</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.header_loader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.header_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>This sets the callback for loading a user from a header value.
The function you set should take an authentication token and
return a user object, or <a class="reference external" href="http://docs.python.org/library/constants.html#None" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">None</span></tt></a> if the user does not exist.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> &#8211; The callback for retrieving a user object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.token_loader">
<tt class="descname">token_loader</tt><big>(</big><em>callback</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.token_loader"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.token_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>This sets the callback for loading a user from an authentication
token. The function you set should take an authentication token
(a <tt class="docutils literal"><span class="pre">unicode</span></tt>, as returned by a user&#8217;s <tt class="xref py py-obj docutils literal"><span class="pre">get_auth_token</span></tt> method) and
return a user object, or <tt class="docutils literal"><span class="pre">None</span></tt> if the user does not exist.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#unicode" title="(in Python v2.7)"><em>unicode</em></a>) &#8211; The callback for retrieving a user object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.ext.login.LoginManager.anonymous_user">
<tt class="descname">anonymous_user</tt><a class="headerlink" href="#flask.ext.login.LoginManager.anonymous_user" title="Permalink to this definition">¶</a></dt>
<dd><p>A class or factory function that produces an anonymous user, which
is used when no one is logged in.</p>
</dd></dl>

<p class="rubric"><a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized" title="flask.ext.login.LoginManager.unauthorized"><tt class="xref py py-obj docutils literal"><span class="pre">unauthorized</span></tt></a> Configuration</p>
<dl class="attribute">
<dt id="flask.ext.login.LoginManager.login_view">
<tt class="descname">login_view</tt><a class="headerlink" href="#flask.ext.login.LoginManager.login_view" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the view to redirect to when the user needs to log in. (This
can be an absolute URL as well, if your authentication machinery is
external to your application.)</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.ext.login.LoginManager.login_message">
<tt class="descname">login_message</tt><a class="headerlink" href="#flask.ext.login.LoginManager.login_message" title="Permalink to this definition">¶</a></dt>
<dd><p>The message to flash when a user is redirected to the login page.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.unauthorized_handler">
<tt class="descname">unauthorized_handler</tt><big>(</big><em>callback</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.unauthorized_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.unauthorized_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>This will set the callback for the <a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized" title="flask.ext.login.LoginManager.unauthorized"><tt class="xref py py-obj docutils literal"><span class="pre">unauthorized</span></tt></a> method, which among
other things is used by <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-obj docutils literal"><span class="pre">login_required</span></tt></a>. It takes no arguments, and
should return a response to be sent to the user instead of their
normal view.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> (<em>function</em>) &#8211; The callback for unauthorized users.</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric"><a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh" title="flask.ext.login.LoginManager.needs_refresh"><tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh</span></tt></a> Configuration</p>
<dl class="attribute">
<dt id="flask.ext.login.LoginManager.refresh_view">
<tt class="descname">refresh_view</tt><a class="headerlink" href="#flask.ext.login.LoginManager.refresh_view" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the view to redirect to when the user needs to
reauthenticate.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.ext.login.LoginManager.needs_refresh_message">
<tt class="descname">needs_refresh_message</tt><a class="headerlink" href="#flask.ext.login.LoginManager.needs_refresh_message" title="Permalink to this definition">¶</a></dt>
<dd><p>The message to flash when a user is redirected to the reauthentication
page.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ext.login.LoginManager.needs_refresh_handler">
<tt class="descname">needs_refresh_handler</tt><big>(</big><em>callback</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#LoginManager.needs_refresh_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.LoginManager.needs_refresh_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>This will set the callback for the <a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh" title="flask.ext.login.LoginManager.needs_refresh"><tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh</span></tt></a> method, which among
other things is used by <a class="reference internal" href="#flask.ext.login.fresh_login_required" title="flask.ext.login.fresh_login_required"><tt class="xref py py-obj docutils literal"><span class="pre">fresh_login_required</span></tt></a>. It takes no arguments,
and should return a response to be sent to the user instead of their
normal view.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> (<em>function</em>) &#8211; The callback for unauthorized users.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id11">
<h3>登录机制<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<dl class="data">
<dt id="flask.ext.login.current_user">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">current_user</tt><a class="headerlink" href="#flask.ext.login.current_user" title="Permalink to this definition">¶</a></dt>
<dd><p>A proxy for the current user.</p>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.login_fresh">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">login_fresh</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#login_fresh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.login_fresh" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns <tt class="docutils literal"><span class="pre">True</span></tt> if the current login is fresh.</p>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.login_user">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">login_user</tt><big>(</big><em>user</em>, <em>remember=False</em>, <em>force=False</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#login_user"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.login_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs a user in. You should pass the actual user object to this. If the
user&#8217;s <tt class="xref py py-obj docutils literal"><span class="pre">is_active</span></tt> method returns <tt class="docutils literal"><span class="pre">False</span></tt>, they will not be logged in
unless <tt class="xref py py-obj docutils literal"><span class="pre">force</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>.</p>
<p>This will return <tt class="docutils literal"><span class="pre">True</span></tt> if the log in attempt succeeds, and <tt class="docutils literal"><span class="pre">False</span></tt> if
it fails (i.e. because the user is inactive).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>user</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#object" title="(in Python v2.7)"><em>object</em></a>) &#8211; The user object to log in.</li>
<li><strong>remember</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; Whether to remember the user after their session expires.
Defaults to <tt class="docutils literal"><span class="pre">False</span></tt>.</li>
<li><strong>force</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If the user is inactive, setting this to <tt class="docutils literal"><span class="pre">True</span></tt> will log
them in regardless. Defaults to <tt class="docutils literal"><span class="pre">False</span></tt>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.logout_user">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">logout_user</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#logout_user"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.logout_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs a user out. (You do not need to pass the actual user.) This will
also clean up the remember me cookie if it exists.</p>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.confirm_login">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">confirm_login</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#confirm_login"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.confirm_login" title="Permalink to this definition">¶</a></dt>
<dd><p>This sets the current session as fresh. Sessions become stale when they
are reloaded from a cookie.</p>
</dd></dl>

</div>
<div class="section" id="id12">
<h3>保护视图<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="flask.ext.login.login_required">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">login_required</tt><big>(</big><em>func</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#login_required"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.login_required" title="Permalink to this definition">¶</a></dt>
<dd><p>If you decorate a view with this, it will ensure that the current user is
logged in and authenticated before calling the actual view. (If they are
not, it calls the <a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized" title="flask.ext.login.LoginManager.unauthorized"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.unauthorized</span></tt></a> callback.) For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/post&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">post</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>If there are only certain times you need to require that your user is
logged in, you can do so with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">current_app</span><span class="o">.</span><span class="n">login_manager</span><span class="o">.</span><span class="n">unauthorized</span><span class="p">()</span>
</pre></div>
</div>
<p>...which is essentially the code that this function adds to your views.</p>
<p>It can be convenient to globally turn off authentication when unit
testing. To enable this, if either of the application
configuration variables <tt class="xref py py-obj docutils literal"><span class="pre">LOGIN_DISABLED</span></tt> or <tt class="xref py py-obj docutils literal"><span class="pre">TESTING</span></tt> is set to
<a class="reference external" href="http://docs.python.org/library/constants.html#True" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">True</span></tt></a>, this decorator will be ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> (<em>function</em>) &#8211; The view function to decorate.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.fresh_login_required">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">fresh_login_required</tt><big>(</big><em>func</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#fresh_login_required"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.fresh_login_required" title="Permalink to this definition">¶</a></dt>
<dd><p>If you decorate a view with this, it will ensure that the current user&#8217;s
login is fresh - i.e. there session was not restored from a &#8216;remember me&#8217;
cookie. Sensitive operations, like changing a password or e-mail, should
be protected with this, to impede the efforts of cookie thieves.</p>
<p>If the user is not authenticated, <a class="reference internal" href="#flask.ext.login.LoginManager.unauthorized" title="flask.ext.login.LoginManager.unauthorized"><tt class="xref py py-meth docutils literal"><span class="pre">LoginManager.unauthorized()</span></tt></a> is
called as normal. If they are authenticated, but their session is not
fresh, it will call <a class="reference internal" href="#flask.ext.login.LoginManager.needs_refresh" title="flask.ext.login.LoginManager.needs_refresh"><tt class="xref py py-meth docutils literal"><span class="pre">LoginManager.needs_refresh()</span></tt></a> instead. (In that
case, you will need to provide a <a class="reference internal" href="#flask.ext.login.LoginManager.refresh_view" title="flask.ext.login.LoginManager.refresh_view"><tt class="xref py py-attr docutils literal"><span class="pre">LoginManager.refresh_view</span></tt></a>.)</p>
<p>Behaves identically to the <a class="reference internal" href="#flask.ext.login.login_required" title="flask.ext.login.login_required"><tt class="xref py py-func docutils literal"><span class="pre">login_required()</span></tt></a> decorator with respect
to configutation variables.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> (<em>function</em>) &#8211; The view function to decorate.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="id13">
<h3>用户对象助手<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="flask.ext.login.UserMixin">
<em class="property">class </em><tt class="descclassname">flask.ext.login.</tt><tt class="descname">UserMixin</tt><a class="reference internal" href="_modules/flask/ext/login.html#UserMixin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.UserMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides default implementations for the methods that Flask-Login
expects user objects to have.</p>
</dd></dl>

</div>
<div class="section" id="id14">
<h3>工具<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="flask.ext.login.login_url">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">login_url</tt><big>(</big><em>login_view</em>, <em>next_url=None</em>, <em>next_field='next'</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#login_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.login_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a URL for redirecting to a login page. If only <tt class="xref py py-obj docutils literal"><span class="pre">login_view</span></tt> is
provided, this will just return the URL for it. If <tt class="xref py py-obj docutils literal"><span class="pre">next_url</span></tt> is provided,
however, this will append a <tt class="docutils literal"><span class="pre">next=URL</span></tt> parameter to the query string
so that the login view can redirect back to that URL.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>login_view</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The name of the login view. (Alternately, the actual
URL to the login view.)</li>
<li><strong>next_url</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The URL to give the login view for redirection.</li>
<li><strong>next_field</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; What field to store the next URL in. (It defaults to
<tt class="docutils literal"><span class="pre">next</span></tt>.)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.ext.login.make_secure_token">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">make_secure_token</tt><big>(</big><em>*args</em>, <em>**options</em><big>)</big><a class="reference internal" href="_modules/flask/ext/login.html#make_secure_token"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#flask.ext.login.make_secure_token" title="Permalink to this definition">¶</a></dt>
<dd><p>This will create a secure token that you can use as an authentication
token for your users. It uses heavy-duty HMAC encryption to prevent people
from guessing the information. (To make it even more effective, if you
will never need to regenerate the token, you can  pass some random data
as one of the arguments.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>*args</strong> &#8211; The data to include in the token.</li>
<li><strong>**options</strong> (<em>kwargs</em>) &#8211; To manually specify a secret key, pass <tt class="docutils literal"><span class="pre">key=THE_KEY</span></tt>.
Otherwise, the <tt class="docutils literal"><span class="pre">current_app</span></tt> secret key will be used.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="id15">
<h3>信号<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>如何在你的代码中使用这些信号请参阅 <a class="reference external" href="http://flask.pocoo.org/docs/signals/">Flask documentation on signals</a>。</p>
<dl class="data">
<dt id="flask.ext.login.user_logged_in">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">user_logged_in</tt><a class="headerlink" href="#flask.ext.login.user_logged_in" title="Permalink to this definition">¶</a></dt>
<dd><p>当一个用户登入的时候发出。除应用（信号的发送者）之外，它还传递正登入的用户 <a class="reference external" href="http://docs.python.org/library/user.html#module-user" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">user</span></tt></a> 。</p>
</dd></dl>

<dl class="data">
<dt id="flask.ext.login.user_logged_out">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">user_logged_out</tt><a class="headerlink" href="#flask.ext.login.user_logged_out" title="Permalink to this definition">¶</a></dt>
<dd><p>当一个用户登出的时候发出。除应用（信号的发送者）之外，它还传递正登出的用户 <a class="reference external" href="http://docs.python.org/library/user.html#module-user" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">user</span></tt></a> 。</p>
</dd></dl>

<dl class="data">
<dt id="flask.ext.login.user_login_confirmed">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">user_login_confirmed</tt><a class="headerlink" href="#flask.ext.login.user_login_confirmed" title="Permalink to this definition">¶</a></dt>
<dd><p>当用户的登入被证实，把它标记为活跃的。（它不用于常规登入的调用。） 它不接受应用以外的任何其它参数。</p>
</dd></dl>

<dl class="data">
<dt id="flask.ext.login.user_unauthorized">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">user_unauthorized</tt><a class="headerlink" href="#flask.ext.login.user_unauthorized" title="Permalink to this definition">¶</a></dt>
<dd><p>当 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 上的 <tt class="xref py py-obj docutils literal"><span class="pre">unauthorized</span></tt> 方法被调用时发出。它不接受应用以外的任何其它参数。</p>
</dd></dl>

<dl class="data">
<dt id="flask.ext.login.user_needs_refresh">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">user_needs_refresh</tt><a class="headerlink" href="#flask.ext.login.user_needs_refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>当 <a class="reference internal" href="#flask.ext.login.LoginManager" title="flask.ext.login.LoginManager"><tt class="xref py py-obj docutils literal"><span class="pre">LoginManager</span></tt></a> 上的 <tt class="xref py py-obj docutils literal"><span class="pre">needs_refresh</span></tt> 方法被调用时发出。它不接受应用以外的任何其它参数。</p>
</dd></dl>

<dl class="data">
<dt id="flask.ext.login.session_protected">
<tt class="descclassname">flask.ext.login.</tt><tt class="descname">session_protected</tt><a class="headerlink" href="#flask.ext.login.session_protected" title="Permalink to this definition">¶</a></dt>
<dd><p>当会话保护起作用时，且会话被标记为非活跃或删除时发出。它不接受应用以外的任何其它参数。</p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <a href="http://github.com/maxcountryman/flask-login"><img style="position: fixed; top: 0; right: 0; border: 0;"
    src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  

  
  </div>
  

  </body>
</html>